<h1>TigerTalk</h1>

{% if user.is_authenticated %}
    <a href="/accounts/logout">Log out</a>
{% else %}
    <form action="{% url 'blog:loginpage' %}" method="get">
            <button name="login" value="{{question.id}}">Click here to Log-in/Register</button>
    </form>
{% endif %}
{% if user.is_authenticated and user.profile.modOrNot %}
	<a href="{% url 'blog:mod' %}"> Mod page </a>
{% endif %}

<h3>Questions</h3>

<a href="{% url 'blog:postaq' %}">Post a question, you curious cat</a>
<br><br>
Filter by tag: 
<form action="{% url 'blog:filter' %}" method="get">
	<input type="text" name="tags" placeholder="#COS #Kintali" value="">
  	<input type="submit" value="Submit">
</form> 
 

{% load el_pagination_tags %}
{% paginate questions starting from page cur_page %}


{% for question in questions %}
{% show_current_number as page_number %}
<div id="resp_results{{question.id}}">
        <a href="{% url 'blog:questions' question.id %}">{{ question.text|truncatechars:200 }}</a> <br>
        {% if user.is_authenticated and not user.profile.blockedOrNot %}
            {% if question in flagged_question_list %}
                You have flagged this question <br>
            {% else %}
                <form action="{% url 'blog:index' %}" method="post">
                		{% csrf_token %}
                        <button name="flag_q" value="{{question.id}}">Flag this question as inappropriate</button>
                        <input type="hidden" name="user_id" value="{{user.id}}">
			 			<input type="hidden" name="page" value="{{page_number}}">
                </form>
            {% endif %}
        {% endif %}
        {% for tag in question.tags.all %}
        	<ul>
        		<li>Tag: {{tag.text}}</li>
        	</ul>
        {% endfor %}
        <br>
        {% if question in expanded_question_list %}
        	<ul>
        	{% for answer in expanded_answers %}
        		<li>{{answer.text}} -{{answer.user.profile.handle}}</li>
        	{% empty %}
        		No answers, lol, sorry.
        	{% endfor %}
        	</ul>
	
        	<form action="{% url 'blog:index' %}#resp_results{{question.id}}" method="get">
				<button name="close_requested" value="{{question.id}}">Close response(s)</button>
				<input type="hidden" name="page" value="{{page_number}}">
			</form>
        {% else %}
			<form action="{% url 'blog:index' %}#resp_results{{question.id}}" method="get">
			        <input type="hidden" name="page" value="{{page_number}}">
				<button name="responses_requested" value="{{question.id}}">See response(s)</button>
			</form>
		{% endif %}
		{% if question in response_question_list %}
			{% if user.is_authenticated and not user.profile.blockedOrNot %}
				<form method="post" action="{% url 'blog:update_responses' %}#resp_results{{question.id}}">
				  {% csrf_token %}
					<textarea type="text" name="response" rows="7" style="width:100%" placeholder="Enter your response..."></textarea>
					<input type="hidden" name="question_id" value="{{question.id}}">
					<input type="submit" value="Submit">
					<input type="hidden" name="user_id" value="{{user.id}}">
					 <input type="hidden" name="page" value="{{page_number}}">
				</form>
			{% else %}
				<form action="{% url 'blog:loginpage' %}" method="get">
									<button name="login" value="{{question.id}}">Please Login to Answer a Question</button>
				</form>
			{% endif %}
		{% else %}
			{% if user.is_authenticated and not user.profile.blockedOrNot %}
				<form action="{% url 'blog:index' %}" method="get">
					<button name="respond_to_q" value="{{question.id}}">Submit a Response</button>
					 <input type="hidden" name="page" value="{{page_number}}">
				</form>
			{% endif %}
		{% endif %}
</div>
{% endfor %}
{% show_pages %}

