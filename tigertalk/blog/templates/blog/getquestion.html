<h1>TigerTalk</h1>

{% if user.is_authenticated %}
    <a href="/accounts/logout">Log out</a>
{% else %}
    <form action="{% url 'blog:loginpage' %}" method="get">
            <button name="login" value="{{question.id}}">Click here to Log-in/Register</button>
    </form>
{% endif %}

<br>
<br>
<a href="{% url 'blog:index' %}">Back to All Questions</a>
<br><br>

<h2>{{ question.text }}</h2>

{% if user.is_authenticated and not user.profile.blockedOrNot %}
             {% if question in flagged_question_list %}
                You have flagged this question <br>
                    <form action="{% url 'blog:questions' question.id %}" method="post">
                        {% csrf_token %}
                        <button name="unflag_q" value="{{question.id}}">Un-flag this question as inappropriate</button>
                        <input type="hidden" name="user_id" value="{{user.id}}">
                        <input type="hidden" name="page" value="{{page_number}}">
                    </form>
            {% else %}
                <form action="{% url 'blog:questions' question.id %}" method="post">
                    {% csrf_token %}
                        <button name="flag_q" value="{{question.id}}">Flag this question as inappropriate</button>
                        <input type="hidden" name="user_id" value="{{user.id}}">
            <input type="hidden" name="page" value="{{page_number}}">
                </form>
            {% endif %}
        {% endif %}
        {% for tag in question.tags.all %}
                <ul>
                        <li>Tag: {{tag.text}}</li>
                </ul>
        {% endfor %}


<ul>
{% load el_pagination_tags %}
{% paginate question.answers.all as answers %}
{% for answer in answers %}
  {% if user.is_authenticated and not user.profile.blockedOrNot %}
                    {% if answer in helpful_responses_list %}
                        You have already marked this answer as helpful <br>
                        <form action="{% url 'blog:questions' question.id %}" method="get">
                            <button name="unhelpful" value="{{answer.id}}">Un-mark this response as helpful</button>
                            <input type="hidden" name="user_id" value="{{user.id}}">
                        </form>
                    {% else %}
                         <form action="{% url 'blog:questions' question.id %}" method="get">
                            <button name="helpful" value="{{answer.id}}">Mark this response as helpful</button>
                            <input type="hidden" name="user_id" value="{{user.id}}">
                        </form>
                    {% endif %}
                    {% if answer in inapp_responses_list %}
                        You have already flagged this answer as inappropriate <br>
                           <form action="{% url 'blog:questions' question.id %}" method="get">
                               <button name="uninapp" value="{{answer.id}}">Un-flag this response as innapropriate</button>
                               <input type="hidden" name="user_id" value="{{user.id}}">
                          </form>
                    {% else %}
                          <form action="{% url 'blog:questions' question.id %}" method="get">
                               <button name="inapp" value="{{answer.id}}">Flag this response as innapropriate</button>
                               <input type="hidden" name="user_id" value="{{user.id}}">
                          </form>
                    {% endif %}
                {% endif %}
                <li>{{answer.text}} - {{answer.user.profile.handle}}</li>
                <li> Helpful Count is {{answer.helpfulCount}} </li> 
                <li> Inappropriate Count is {{answer.inappropriateCount}} </li> 
{% empty %}
     No answers, lol, sorry.
{% endfor %}
{% show_pages %}
</ul>
{% if user.is_authenticated and not user.profile.blockedOrNot %}
<form method="post" action="{% url 'blog:update_responses' %}#resp_results{{question.id}}">
{% csrf_token %}
<textarea type="text" name="response" rows="7" style="width:100%" placeholder="Enter your response..."></textarea>
<input type="hidden" name="question_id" value="{{question.id}}">
<input type="submit" value="Submit">
<input type="hidden" name="user_id" value="{{user.id}}">
<input type="hidden" name="page" value="{{page_number}}">
</form>
{% else %}
<form action="{% url 'blog:loginpage' %}" method="get">
<button name="login" value="{{question.id}}">Please Login to Answer a Question</button>
</form>
{% endif %}

